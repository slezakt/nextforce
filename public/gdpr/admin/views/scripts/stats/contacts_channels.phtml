<!-- Vsechen html kod adminu pred obsahem teto stranky -->
<?=$this->render('admin_top.phtml')?>

<div class="statistics">

<?=$this->render('statsmenu.phtml')?>
<td>
  <h5>Počet kontaktů dle jednotlivých kanálů</h5>

<table id="stat-main" class="stat">
    <tr>
        <th>kanál</th>
        <th>počet</th>
        <th>%</th>
    </tr>
<?php 
$totalCount = 0;
foreach ($this->channels as $channel) {
    $totalCount += $channel['count'];  
?>

    <tr>
        <td><?=$channel['name'] ?></td>
        <td><?=$channel['count'] ?> <img src="/pub/img/admin/icon-xls.png"></td>
        <td><?=$channel['percents'] ?></td>
    </tr>
<?php 
}
?>
    <tr>
        <th>všechny kanály</th>
        <th><?=$totalCount ?></th>
        <th><?php 
            $percentage = bcdiv($totalCount, $this->usersCount);
            $percentage = bcmul($percentage, 100);
            echo $percentage.'%';
        ?></th>
    </tr>
</table>
        
</td>
<td>
	<?php 
	if ( !empty($this->channelChart) ) {	    
	    echo '<img src="'.$this->url(array('action' => 'getchart', 'controller' => 'service', 'module' => 'default')).'?'.$this->channelChart.'" />';
	}
	?>
</td>
</tr>

<?php 
if ( !empty($this->timeChart) ) {        
    echo '<tr>
        <td></td>
        <td colspan="2">
            <h5>Počet kontaktů dle jednotlivých kanálů</h5>
            <img src="'.$this->url(array('action' => 'getchart', 'controller' => 'service', 'module' => 'default')).'?'.$this->timeChart.'" />
         </td></tr>
    ';
}
?>
<?php
if ( !empty($this->overview) ) {
        
$channelsCount = $this->channelsCount;
$overview = $this->overview;

?>
<tr>
<td></td>
<td colspan="2">
    <table class="stat">
        <th>vydání</th>
        <?php        
        /**
         * nadpisy tabulky
         */
        for ($i = 0; $i < $channelsCount; $i++) {                      
            echo '<th>'.$overview[$i]['channel'].'</th>';
        }
        ?>
        <th>všechny kanály</th>
        
        <?php 
        /**
         * data
         */
       $counter = 0;
       $i = 0;
       $cols = $channelsCount + 2;       
       
       //pocet uzivatelu celkem
       $totalUsers = array();
       $_tu = 0;       
       
       foreach ($overview as $line) {           
           $_tu += $line['count'];           
           $counter++;                     
           if ( ($counter == $channelsCount) ) {                  
                array_push($totalUsers, $_tu);
                $counter = 0;
                $_tu = 0;               
           }                      
       }
       
       // vypis data       
       for ($i = 0; $i < $this->bulletinsCount; $i++) {
           echo '<tr>';
           echo '<td>'.$overview[$i*$channelsCount]['bulletin'].'</td>';
           $from = $i*$channelsCount;           
           $to = $i*$channelsCount+$channelsCount;
           
           for ($ii = $from; $ii < $to; $ii++) {               
               $division = intval(bcdiv($overview[$ii]['count'], $totalUsers[$i])*100);
               echo '<td>'.$overview[$ii]['count'];
               echo ' ('.$division.'%)';                              
               echo '</td>';                 
           }
           echo '<td>'.$totalUsers[$i].'</td>';
           echo '</tr>';       
       }                     
       ?>

    </table>
</td>
</tr>
<?php
    
}
?>

</table>

</div>


<!-- Vsechen html kod adminu za obsahem teto stranky -->
<?=$this->render('admin_bottom.phtml')?>
